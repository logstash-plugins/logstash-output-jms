:plugin: jms
:type: output
:default_codec: plain

///////////////////////////////////////////
START - GENERATED VARIABLES, DO NOT EDIT!
///////////////////////////////////////////
:version: %VERSION%
:release_date: %RELEASE_DATE%
:changelog_url: %CHANGELOG_URL%
:include_path: ../../../../logstash/docs/include
///////////////////////////////////////////
END - GENERATED VARIABLES, DO NOT EDIT!
///////////////////////////////////////////

[id="plugins-{type}s-{plugin}"]

=== Jms output plugin

include::{include_path}/plugin_header.asciidoc[]

==== Description

Write events to a Jms Broker. Supports both Jms Queues and Topics.

For more information about Jms, see <https://javaee.github.io/tutorial/jms-concepts.html>
For more information about the Ruby Gem used, see <http://github.com/reidmorrison/jruby-jms>

JMS configurations can be done either entirely in the Logstash configuration file, or in a mixture of the Logstash
  configuration file, and a specified yaml file. Simple configurations that do not need to make calls to implementation
  specific methods on the connection factory can be specified entirely in the Logstash configuration, whereas more complex
  configurations, should also use the combination of yaml file and Logstash configuration.


==== Common Configuration Options

Here is a config example to write to a queue:
 jms {
    broker_url => 'ssl://localhost:61617' <1>
    destination => "myqueue" <2>
    pub-sub => false <3>
    username => <4>
    password => <4>
    keystore => <5>
    keystore_password => <5>
    truststore => <5>
    truststore_password => <5>
  }

<1> Url of the broker to connect to. Please consult your JMS provider documentation for the exact syntax to use
    here, including how to enable failover.
<2> Name of the topic or queue that the plugin will publish events to.
<3> Determines whether the event source is a queue or a topic, set to `true` for topic, `false` for queue.
<4> Credentials to use when connecting to the JMS provider, if required.
<5> Keystore and Truststore to use when connecting to the JMS provider, if required.



==== Logstash Configuration


===== Sample Configuration for Non-JNDI Connection
[source,ruby]
--------------------------------------------------
 jms {
    destination => "myqueue" <1>
    pub-sub => false <1>
    username => xxxx <2>
    password => xxxx <2>
    factory => org.apache.activemq.ActiveMQConnectionFactory <3>
    require_jars => ['/usr/share/jms/activemq-all-5.15.9.jar','/usr/share/jms/log4j-1.2.17.jar'] <4>
  }
--------------------------------------------------

<1> Configuration settings
<2> Username and password for the connection.
<3> Full name (including package name) of Java connection factory used to create a connection with your JMS provider.
<4> List of jars required by the JMS provider. Paths should be the fully qualified location of all jar files required
     by the JMS provider. This list may also include dependent jars as well as specific jars from the JMS provider.


===== Sample Configuration for JNDI Connection
[source,ruby]
--------------------------------------------------
 jms {
    destination => "myqueue" <1>
    pub-sub => false <1>
    jndi_name => /jms/cf/default <2>
    jndi_context => {
     'java.naming.factory.initial' => com.solacesystems.jndi.SolJNDIInitialContextFactory
     'java.naming.security.principal' => solace-cloud-client@user
     'java.naming.provider.url' => tcp://address.messaging.solace.cloud:20608
     'java.naming.security.credentials' => verysecret
    } <3>
    require_jars=> ['/usr/share/jms/commons-lang-2.6.jar',
                    '/usr/share/jms/sol-jms-10.5.0.jar',
                    '/usr/share/jms/geronimo-jms_1.1_spec-1.1.1.jar',
                    '/usr/share/jms/commons-lang-2.6.jar]' <4>
  }
--------------------------------------------------

<1> Configuration settings
<2> Username and password for the connection.
<3> JNDI context settings hash. Contains details of how to connect to JNDI server. See your JMS provider documentation for
     implementation specific details.
<4> List of jars required by the JMS provider. Paths should be the fully qualified location of all jar files required
     by the JMS provider. This list may also include dependent jars as well as specific jars from the JMS provider.

==== Logstash Configuration and Yaml File


How you configure the `yaml` file depends on whether the connection is via JNDI:


===== Sample Configuration for Non-JNDI Connection


====== Logstash Configuration

[source,ruby]
--------------------------------------------------
 jms {
    destination => "myqueue" <1>
    pub-sub => false <1>
    username => xxxx <2>
    password => xxxx <2>
    yaml_file => "~/jms.yml"  <3>
    yaml_section => "mybroker" <4>
  }
--------------------------------------------------


<1> Configuration settings
<2> Username and password for the connection.
<3> Full path to a yaml file containing the definition for the ConnectionFactory.
<4> Section name in the yaml file of the ConnectionFactory for this plugin definition


====== YAML File Configuration

[source,yaml]
--------------------------------------------------
mybroker: <1>
  :factory: org.apache.activemq.ActiveMQConnectionFactory <2>
  :send_timeout: 30000 <3>
  :stats_enabled: true <3>
  :require_jars: <4>
    - /usr/share/jms/activemq-all-5.15.9.jar
    - /usr/share/jms/log4j-1.2.17.jar
--------------------------------------------------

 <1> Section name for this broker definition. This should be the value of `yaml_section` in the logstash configuration file.
 <2> Full name (including package name) of Java connection factory used to create a connection with your JMS provider.
 <3> Implementation specific configuration parameters to be used with the connection factory specified
   in <2>. Each JMS Provider will have its own set of parameters that can be used here. These parameters are mapped to
   `set` methods on the provided connection factory, and can be supplied in either 'snake' or 'camel' case. In <3> above,
   the `send_timeout` property will call the `setSendTimeout` on the supplied connection factory. See your JMS provider
   documentation for implementation specific details.
 <4> List of jars required by the JMS provider. Paths should be the fully qualified location of all jar files required
     by the JMS provider. This list may also include dependent jars as well as specific jars from the JMS provider.

===== Sample Configuration for JNDI Connection

The JMS plugin also supports connecting to brokers using JNDI. Configuration can be done either using a yaml file, or
 via the logstash configuration:

====== Logstash Configuration

[source,ruby]
--------------------------------------------------
 jms {
    destination => "myqueue" <1>
    pub-sub => false <1>
    yaml_file => "~/jms.yml"  <2>
    yaml_section => "mybroker" <3>
  }
--------------------------------------------------

<1> Configuration settings
<2> Full path to a yaml file containing the definition for the ConnectionFactory.
<3> Section name in the yaml file of the ConnectionFactory for this plugin definition

====== YAML File Configuration

[source,yaml]
--------------------------------------------------

solace: <1>
  :jndi_name: /jms/cf/default <2>
  :jndi_context: <3>
    java.naming.factory.initial: com.solacesystems.jndi.SolJNDIInitialContextFactory
    java.naming.security.principal: solace-cloud-client@user
    java.naming.provider.url: tcp://address.messaging.solace.cloud:20608
    java.naming.security.credentials: verysecret
  :require_jars: <4>
    - /usr/share/jms/commons-lang-2.6.jar
    - /usr/share/jms/sol-jms-10.5.0.jar
    - /usr/share/jms/geronimo-jms_1.1_spec-1.1.1.jar
    - /usr/share/jms/commons-lang-2.6.jar

--------------------------------------------------

<1> Section name for this broker definition. This should be the value of `yaml_section` in the Logstash configuration file.
<2> Name of JNDI entry at which the Factory can be found
<3> JNDI context settings. Contains details of how to connect to JNDI server. See your JMS provider documentation for
     implementation specific details.
<4> List of jars required by the JMS provider. Paths should be the fully qualified location of all jar files required
     by the JMS provider. This list may also include dependent jars as well as specific jars from the JMS provider.


==== Jar files

In order to communicate with a JMS broker, the plugin must load the jar files necessary for each client type.
This can be set in the yaml file, or in the main configuration if a yaml file is not necessary. The `require_jars`
  setting should include the full path for each jar file required for the client. Eg

logstash configuration:

  jms {
          :
          [snip]
     require_jars => ['/usr/share/jms/commons-lang-2.6.jar',
                      '/usr/share/jms/sol-jms-10.5.0.jar',
                      '/usr/share/jms/geronimo-jms_1.1_spec-1.1.1.jar',
                      '/usr/share/jms/commons-lang-2.6.jar']

  }

===== Setting System Properties

Many JMS providers allow or expect System properties to be set to configure certain properties when using JMS, for
example, the Apache qpid JMS client allows the connection factory lookup to be stored there, and the Solace JMS client
allows many properties, such as number of connection retries to be set as System properties. These can be set using the
`system_properties` configuration option, or via the Logstash `jvm.options` file. Bear in mind that System properties
are scoped to the JVM process, so multiple inputs/outputs may not use different settings for System properties.

===== Multiple JMS inputs/outputs in the same Logstash process

The use of multiple JMS consumers and producers in the same Logstash process is unsupported if:

  * System properties need to be different for any of the consumers/producers
  * Different keystores or truststores are required for any of the consumers/producers


[id="plugins-{type}s-{plugin}-options"]
==== Jms Output Configuration Options

This plugin supports the following configuration options plus the <<plugins-{type}s-{plugin}-common-options>> described later.

[cols="<,<,<",options="header",]
|=======================================================================
|Setting |Input type|Required
| <<plugins-{type}s-{plugin}-broker_url>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-delivery_mode>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-destination>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-factory>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-jndi_context>> |<<hash,hash>>|No
| <<plugins-{type}s-{plugin}-jndi_name>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-keystore>> |a valid filesystem path|No
| <<plugins-{type}s-{plugin}-keystore_password>> |<<password,password>>|No
| <<plugins-{type}s-{plugin}-password>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-priority>> |<<number,number>>|No
| <<plugins-{type}s-{plugin}-pub_sub>> |<<boolean,boolean>>|No
| <<plugins-{type}s-{plugin}-require_jars>> |<<array,array>>|No
| <<plugins-{type}s-{plugin}-system_properties>> |<<hash,hash>>|No
| <<plugins-{type}s-{plugin}-time_to_live>> |<<number,number>>|No
| <<plugins-{type}s-{plugin}-truststore>> |a valid filesystem path|No
| <<plugins-{type}s-{plugin}-truststore_password>> |<<password,password>>|No
| <<plugins-{type}s-{plugin}-username>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-yaml_file>> |<<string,string>>|No
| <<plugins-{type}s-{plugin}-yaml_section>> |<<string,string>>|No
|=======================================================================

Also see <<plugins-{type}s-{plugin}-common-options>> for a list of options supported by all
output plugins.

&nbsp;

[id="plugins-{type}s-{plugin}-broker_url"]
===== `broker_url` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Url to use when connecting to the JMS provider

[id="plugins-{type}s-{plugin}-delivery_mode"]
===== `delivery_mode` 

  * Value type is <<string,string>>
  * Default value is `nil`

Name of delivery mode to use
Options are "persistent" and "non_persistent" if not defined, nothing will be passed and the default delivery
 mode will be used.

[id="plugins-{type}s-{plugin}-destination"]
===== `destination` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Name of the destination queue or topic to use.
Mandatory

[id="plugins-{type}s-{plugin}-factory"]
===== `factory` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Full name (including package name) of Java connection factory used to create a connection with your JMS provider.

[id="plugins-{type}s-{plugin}-jndi_context"]
===== `jndi_context` 

  * Value type is <<hash,hash>>
  * There is no default value for this setting.

Mandatory if jndi lookup is being used,
contains details on how to connect to JNDI server

[id="plugins-{type}s-{plugin}-jndi_name"]
===== `jndi_name` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Name of JNDI entry at which the Factory can be found

[id="plugins-{type}s-{plugin}-keystore"]
===== `keystore`

  * Value type is <<path,path>>
  * There is no default value for this setting.

If you need to use a custom keystore (`.jks`) specify it here. This does not work with .pem keys

[id="plugins-{type}s-{plugin}-keystore_password"]
===== `keystore_password`

  * Value type is <<password,password>>
  * There is no default value for this setting.

Specify the keystore password here.
Note, most .jks files created with keytool require a password

[id="plugins-{type}s-{plugin}-password"]
===== `password` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Password to use when connecting to the JMS provider

[id="plugins-{type}s-{plugin}-priority"]
===== `priority`

  * Value type is <<number,number>>
  * There is no default value

Sets the producer's default priority. The default value will be whatever is provided by the JMS Provider

[id="plugins-{type}s-{plugin}-pub_sub"]
===== `pub_sub` 

  * Value type is <<boolean,boolean>>
  * Default value is `false`

If pub-sub (topic) style should be used or not.
Mandatory

[id="plugins-{type}s-{plugin}-require_jars"]
===== `require_jars` 

  * Value type is <<array,array>>
  * There is no default value for this setting.

An optional array of Jar file names to load for the specified JMS provider.
By using this option it is not necessary to put all the JMS Provider specific jar files into the
java CLASSPATH prior to starting Logstash.

[id="plugins-{type}s-{plugin}-system_properties"]
===== `system_properties`

  * Value type is <<hash,hash>>
  * There is no default value for this setting.

Any System properties that the JMS provider requires can be set either in a Hash here, or in `jvm.options`

[id="plugins-{type}s-{plugin}-time_to_live"]
===== `time_to_live`

  * Value type is <<number,number>>
  * There is no default value

Sets the length of time in milliseconds from its dispatch time that a produced message should be retained by the message
system. The default value will be whatever is provided by the JMS Provider.

[id="plugins-{type}s-{plugin}-truststore"]
===== `truststore`

  * Value type is <<path,path>>
  * There is no default value for this setting.

If you need to use a custom truststore (`.jks`) specify it here. This does not work with .pem certs.

[id="plugins-{type}s-{plugin}-truststore_password"]
===== `truststore_password`

  * Value type is <<password,password>>
  * There is no default value for this setting.

Specify the truststore password here. This setting is only used if `truststore` is set.
Note, most .jks files created with keytool require a password.


[id="plugins-{type}s-{plugin}-username"]
===== `username` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Username to connect to JMS provider with

[id="plugins-{type}s-{plugin}-yaml_file"]
===== `yaml_file` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Yaml config file

[id="plugins-{type}s-{plugin}-yaml_section"]
===== `yaml_section` 

  * Value type is <<string,string>>
  * There is no default value for this setting.

Yaml config file section name
For some known examples, see: [Example jms.yml](https://github.com/reidmorrison/jruby-jms/blob/master/examples/jms.yml)



[id="plugins-{type}s-{plugin}-common-options"]
include::{include_path}/{type}.asciidoc[]

:default_codec!: